<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Mi ubicación actual...</title>	
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.6.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.6.1/mapbox-gl.css" rel="stylesheet" />
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

<style>
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<script id="Messenger" src="//connect.facebook.net/en_US/messenger.Extensions.js"></script><script>
			(function(d, s, id){
				  var js, fjs = d.getElementsByTagName(s)[0];		
				  if (d.getElementById(id)) {return;}
				  js = d.createElement(s); js.id = id;		
				  js.src = "//connect.facebook.net/en_US/messenger.Extensions.js";
				  fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'Messenger'));	


var psid;
	  window.extAsyncInit = function() {
			  //obtener ID DEL USUARIO
			    MessengerExtensions.getUserID(function success(uids) {
				// User ID was successfully obtained. 
				 psid = uids.psid;
			   //alert(psid);
				}, function error(err, errorMessage) {      
					alert(errorMessage); 
				});    
		
		  };
		  
		</script> 	
<div id="map"></div>

<nav class="navbar fixed-bottom navbar-expand-sm " style="display:inline !important;visibility: hidden;">
			<center>
			<textarea class="form-control m-1" placeholder="Ingresa alguna referencia y llegaremos más rapido..." style="width:100%"></textarea>
			
			<a id="location" style="width:100%" href="#" onclick="hola()" class="btn btn-warning form-control m-1 text-white"><i class="fas fa-map-marked-alt"></i> AGREGAR UBICACIÓN</a> 
		</center>
</nav>	

		
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiamVwaWNhbWUiLCJhIjoiY2s1ZGdzZHR5MThtOTNtcndrYnc2cHZzcCJ9.WFU78lBCRGHhjTpSgxytcw';
var map = new mapboxgl.Map({
container: 'map', // container id
style: 'mapbox://styles/mapbox/satellite-streets-v11',
center: [-77.1566537,-11.7825409], // starting position
zoom: 12 // starting zoom  
});	

var geolocate = new mapboxgl.GeolocateControl();

map.addControl(geolocate);
var lon,lat;
geolocate.on('geolocate', function(e) {
       lon = e.coords.longitude;
       lat = e.coords.latitude;
	  $(".navbar").css("visibility","visible");
});



function hola() {		
	//alert(lat+" "+lon +" "+psid);
	
	
		Swal.fire({
  title: 'CONFIRMAR',
  text: "Desea agregar esta ubicación",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'CONFIRMAR'
}).then((result) => {
  if (result.value) {
    
	
	$.ajax({      
								type: 'GET',  
								url: '//cb.easybuydelivery.com/ASDasdlngASDasd',  		
								data: {
									'psid': psid,	 
									'lon':lon,
									'lat':lat
								},
								success: function(data){
									
									/*
									// the Messenger Extensions JS SDK is done loading    
									MessengerExtensions.requestCloseBrowser(function success() {
									  // webview closed
									}, function error(err) {
									  // an error occurred 
									}); */
										
									
									Swal.fire(
 data,
  'That thing is still around?',
  'question'
)
									
																
								},
								error: function (request, status, error) { 
									swal({ 
											title:"Ocurrio un error", 
											text:request.responseText, 
											icon: "error",  	
											closeOnEsc: false,
											closeOnClickOutside: false,	
											button: false,
										})
								}  
							});
	
	
	
  }
})


				
	

}

$(".mapboxgl-ctrl-bottom-left").hide();		
$(".mapboxgl-ctrl-bottom-right").hide();		
</script>





</body>
</html>
